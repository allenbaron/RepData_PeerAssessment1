---
title: "Reproducible Research: Peer Assessment 1"
author: "Allen Baron"
date: "3/30/2017"
output: 
  html_document:
    keep_md: true
---

``` {r global_opts, include = FALSE}
knitr::opts_chunk$get()
knitr::opts_chunk$set(fig.width = 4, fig.height = 3)
```

## Loading and preprocessing the data
_Note:_ `read_csv()` from the `readr` package "flexibly parse many types of data found in the wild, while still cleanly failing when data unexpectedly changes"
([readr README](https://cran.r-project.org/web/packages/readr/README.html), so little preprocessing is needed at this stage.

``` {r preload, eval = -3, results = "hide"}
library(tidyverse)
library(lubridate)
library(gridExtra)
unzip("activity.zip")
```

```{r load_data}
activity <- read_csv("activity.csv")
problems(activity) # check for errors in loading/parsing
str(activity)
summary(activity)
```
1. Load the data (i.e. 𝚛𝚎𝚊𝚍.𝚌𝚜𝚟())
2. Process/transform the data (if necessary) into a format suitable for your analysis


## What is mean total number of steps taken per day?
``` {r total_steps}
by_date <- group_by(activity, date)
daily_steps <- summarize(by_date, total = sum(steps, na.rm = TRUE))
daily_hist <- qplot(total, data = daily_steps, bins = 20,
      xlab = "total steps per day",
      main = "Histogram")
daily_hist
```
2. If you do not understand the difference between a histogram and a barplot, research the difference between them. Make a histogram of the total number of steps taken each day
3. Calculate and report the mean and median of the total number of steps taken per day

``` {r mean_median}
avg_day <- mean(daily_steps$total)
med_day <- median(daily_steps$total)
```

- Mean number of steps taken each day = `r avg_steps`
- Median number of steps taken each day = `r med_steps`.

## What is the average daily activity pattern?
Time series plot of the 5-minute interval and the average number of steps taken, averaged across all days:
``` {r interval_steps}
avg_int <- group_by(activity, interval) %>%
                summarize(avg_steps = mean(steps, na.rm = TRUE))
qplot(interval, avg_steps, data = avg_int, geom = "line",
      main = "Avg steps for each interval, averaged over all days")
```

``` {r max_avg_interval}
max_steps <- max(avg_int$avg_steps)
max_int <- avg_int[avg_int$avg_steps %in% max_steps, "interval"]
```

The 5-minute interval, on average across all the days in the dataset, that contains the maximum number of steps is `r max_int`.


## Imputing missing values
The following table shows the total number of NA values for each column of the data set.

``` {r total_missing}
total_NA <- summarize_each(activity, funs(sum(is.na(.))))
total_NA
```
Total rows with NA values = `r total_NA$steps`

Before deciding how to impute NA values it's probably best to see if there is any pattern.
``` {r missing_info}
NA_vals <- filter(activity, is.na(activity$steps))
qplot(interval, date, data = NA_vals,
      main = "Date-Intervals with missing data")
date_NA <- unique(NA_vals$date)
int_NA <- unique(NA_vals$interval)
```
There is not an observable pattern in which days have missing values but there is definitely a pattern in which intervals have missing values. It looks like the values are missing for almost all of the intervals on each of the days except for those intervals represented by the blank spots in the graph. Let's first confirm that the missing values span the entire day by comparing the min and max intervals for the missing data to the min and max intervals from the original data.

``` {r missing_interval}
range_int <- c(min(activity$interval), max(activity$interval))
range_NA <- c(min(NA_vals$interval), max(NA_vals$interval))
identical(range_int, range_NA)
```
We've confirmed that the missing values span the whole day. Now what about those strange intervals where there appear to be measurements (those blank spaces in the plot). Are they actual measurements that were somehow taken or do they represent gaps in the original data set we were not made aware of? We'll compare the unique intervals in NA_vals to the unique intervals in the original data set.

``` {r missing_gaps}
identical(unique(NA_vals$interval), unique(activity$interval))
gap_length <- max(int_NA[2:length(int_NA)] - int_NA[1:(length(int_NA) - 1)] - 5)
```

Interesting. I guess the original data is _NOT exactly_ recorded in 5-min intervals. There are a number of `r gap_length` minute gaps in the original data set and no extra gaps in the missing data set. So we can conclude that for the complete set of values is missing for each of the days, including all intervals.

Given the assumption that people are 'creatures of habit' I have decided to fill in the missing values based on weekday. Specifically, I will impute the median of each interval over each weekday to the days in question according to which day of the week it is.

``` {r impute_values}
activity <- mutate(activity, weekday = wday(date, label = TRUE),
                             impute = is.na(steps))
measured <- filter(activity, impute == FALSE)
med_steps <- group_by(measured, weekday, interval) %>%
                summarize(median = median(steps))

# ensure no missing values for calculated medians
all(complete.cases(med_steps)) 

# impute median values into 'steps'
imputed <- filter(activity, impute == TRUE) %>%
            inner_join(med_steps, by = c("weekday", "interval")) %>%
            mutate(steps = median, median = NULL) # removes extra column

# recombine measured and imputed
activity_adj <- rbind(measured, imputed)
```
With the new imputed data set let's revisit the histogram of the total number of steps taken each day, calculate the mean and median total number of steps taken per day, and then compare these values with the originals from the first part of the project.

``` {r imputed_total_steps, fig.width = 6, fig.height = 4}
by_date_adj <- group_by(activity_adj, date)
daily_steps_adj <- summarize(by_date_adj, total = sum(steps))
daily_hist_adj <- qplot(total, data = daily_steps_adj, bins = 20,
      xlab = "total steps per day",
      main = "Histogram (imputed values)")
avg_day_adj <- mean(daily_steps_adj$total)
med_day_adj <- median(daily_steps_adj$total)

grid.arrange(daily_hist, daily_hist_adj, ncol = 2)
```
It's difficult to get much from the histogram with such a small data set but the net effect of imputing values by interval and weekday was to shift the number of days with zero total steps per day to higher values with most still falling below 5,000 steps per day.

**Looking at the changes in mean and median:**

Data set | Mean | Median
---------|------|-------
Original | `r avg_day` | `r med_day`
Imputed | `r avg_day_adj` | `r med_day_adj`

Imputing values increased the mean somewhat, as would be expected with less zero values, but it had no effect on the median.


## Are there differences in activity patterns between weekdays and weekends?

For this part the 𝚠𝚎𝚎𝚔𝚍𝚊𝚢𝚜() function may be of some help here. Use the dataset with the filled-in missing values for this part.

Create a new factor variable in the dataset with two levels – “weekday” and “weekend” indicating whether a given date is a weekday or weekend day.
Make a panel plot containing a time series plot (i.e. 𝚝𝚢𝚙𝚎 = "𝚕") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis). See the README file in the GitHub repository to see an example of what this plot should look like using simulated data.
